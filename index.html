<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SSN Chat Overlay</title>

<link href="https://fonts.googleapis.com/css2?family=Host+Grotesk:wght@300..800&display=swap" rel="stylesheet">

<style>
html,body{
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    overflow:hidden;
    background:transparent;
    font-family:'Host Grotesk',sans-serif;
}

#chat-container{
    padding:20px;
    max-width:420px;
    height:100%;
    overflow:hidden;
}

.message-container{
    margin-bottom:12px;
    animation:slideIn .25s ease forwards;
}

@keyframes slideIn{
    from{opacity:0;transform:translateY(10px)}
    to{opacity:1;transform:translateY(0)}
}

.message{
    background:rgba(25,25,25,.95);
    border-left:4px solid #999;
    padding:12px;
    border-radius:0 10px 10px 0;
    color:#fff;
}

.twitch-message .message{border-color:#9146FF}
.kick-message .message{border-color:#53FC18}

.user-info{
    display:flex;
    align-items:center;
    gap:6px;
    margin-bottom:6px;
}

.username-wrapper{
    padding:4px 10px;
    border-radius:20px;
    font-weight:600;
    font-size:.9em;
    background:#444;
}

.broadcaster .username-wrapper{background:#ff0000;color:#fff}
.moderator .username-wrapper{background:#00ff00;color:#000}
.vip .username-wrapper{background:#ffd700;color:#000}
.subscriber .username-wrapper{background:#800080;color:#fff}

.badges{
    display:flex;
    gap:4px;
}

.badge{
    width:18px;
    height:18px;
}

.platform-icon{
    width:16px;
    height:16px;
    font-size:10px;
    font-weight:bold;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:3px;
}

.twitch-icon{background:#9146FF;color:#fff}
.kick-icon{background:#53FC18;color:#000}

.message-text{
    font-size:14px;
    line-height:1.4;
}

.event-message{
    background:rgba(255,215,0,.15);
    border:1px solid #ffd700;
    color:#ffd700;
    padding:10px;
    border-radius:8px;
    margin-bottom:10px;
    text-align:center;
    font-weight:bold;
}
</style>
</head>

<body>
<div id="chat-container"></div>

<script>
const chatContainer=document.getElementById("chat-container");
const params=new URLSearchParams(location.search);
const roomID=params.get("session")||"default";

const BADGES={
    broadcaster:"https://static-cdn.jtvnw.net/badges/v1/5527c58c-fb7d-422d-b71b-f309dcb85cc1/1",
    moderator:"https://static-cdn.jtvnw.net/badges/v1/3267646d-33f0-4b17-b3df-f923a41db1d0/1",
    vip:"https://static-cdn.jtvnw.net/badges/v1/b817aba4-fad8-49e2-b88a-7cc744dfa6ec/1",
    subscriber:"https://static-cdn.jtvnw.net/badges/v1/5d9f2208-5dd8-11e7-8513-2ff4adfae661/1"
};

function detectPlatform(d){
    return (d.platform||d.type||"twitch").toLowerCase().includes("kick")?"kick":"twitch";
}

function detectRole(badges=[]){
    if(!Array.isArray(badges))return"viewer";
    for(const b of badges){
        const t=(b.type||"").toLowerCase();
        if(t.includes("broadcaster"))return"broadcaster";
        if(t.includes("moderator")||t==="mod")return"moderator";
        if(t.includes("vip"))return"vip";
        if(t.includes("subscriber")||t==="sub")return"subscriber";
    }
    return"viewer";
}

function renderBadges(badges){
    if(!Array.isArray(badges))return"";
    return `<div class="badges">${
        badges.map(b=>b.src?`<img class="badge" src="${b.src}">`:"").join("")
    }</div>`;
}

function addMessage(data){
    if(!data.chatmessage && !data.event)return;

    if(data.event){
        const e=document.createElement("div");
        e.className="event-message";
        e.textContent=data.event;
        chatContainer.appendChild(e);
        return;
    }

    const platform=detectPlatform(data);
    const role=detectRole(data.chatbadges);
    const msg=document.createElement("div");

    msg.className=`message-container ${platform}-message ${role}`;
    msg.innerHTML=`
        <div class="message">
            <div class="user-info">
                <div class="platform-icon ${platform}-icon">${platform[0].toUpperCase()}</div>
                <div class="username-wrapper">${data.chatname||"User"}</div>
                ${renderBadges(data.chatbadges)}
            </div>
            <div class="message-text">${data.chatmessage||""}</div>
        </div>
    `;

    chatContainer.appendChild(msg);
    msg.scrollIntoView({behavior:"smooth",block:"end"});
}

const iframe=document.createElement("iframe");
iframe.src=`https://vdo.socialstream.ninja/?ln&push&novideo&noaudio&cleanoutput&room=${roomID}`;
iframe.style.cssText="width:0;height:0;position:fixed;left:-100px;top:-100px";
document.body.appendChild(iframe);

window.addEventListener("message",e=>{
    if(e.data?.dataReceived?.overlayNinja){
        addMessage(e.data.dataReceived.overlayNinja);
    }
});
</script>
</body>
</html>
