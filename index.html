<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>SSN Advanced Chat Overlay</title>

<link href="https://fonts.googleapis.com/css2?family=Host+Grotesk:wght@300..800&display=swap" rel="stylesheet">

<style>
html,body{
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    overflow:hidden;
    background:transparent;
    font-family:'Host Grotesk',sans-serif;
}

#chat-container{
    padding:20px;
    max-width:440px;
}

/* animações */
.message-container{
    margin-bottom:12px;
    animation:in .3s ease forwards;
}
.fade-out{
    animation:out .4s ease forwards;
}

@keyframes in{
    from{opacity:0;transform:translateY(12px)}
    to{opacity:1;transform:translateY(0)}
}
@keyframes out{
    to{opacity:0;transform:translateY(-10px)}
}

.message{
    background:rgba(25,25,25,.95);
    border-left:4px solid #888;
    padding:12px;
    border-radius:0 12px 12px 0;
    color:#fff;
}

/* plataformas */
.twitch .message{border-color:#9146FF}
.kick .message{border-color:#53FC18}

.user-info{
    display:flex;
    align-items:center;
    gap:6px;
    margin-bottom:6px;
}

.username{
    padding:4px 10px;
    border-radius:20px;
    font-weight:600;
    font-size:.9em;
    background:#444;
}

/* cargos */
.broadcaster .username{background:#ff0000}
.moderator .username{background:#00ff00;color:#000}
.vip .username{background:#ffd700;color:#000}
.subscriber .username{background:#800080}

/* badges */
.badges{display:flex;gap:4px}
.badge{width:18px;height:18px}

/* logos */
.platform-logo{
    width:18px;
    height:18px;
}
.message-text{font-size:14px;line-height:1.4}
</style>
</head>

<body>
<div id="chat-container"></div>

<script>
const chat=document.getElementById("chat-container");
const params=new URLSearchParams(location.search);

const SESSION=params.get("session")||"default";
const DURATION=(params.get("duration")||10)*1000;
const PLATFORMS=params.get("platforms")||"both";

const LOGOS={
    twitch:"https://static-cdn.jtvnw.net/ttv-boxart/Twitch.png",
    kick:"https://kick.com/favicon.ico"
};

function detectPlatform(d){
    return (d.platform||d.type||"twitch").toLowerCase().includes("kick")?"kick":"twitch";
}

function detectRole(badges=[]){
    if(!Array.isArray(badges))return"viewer";
    for(const b of badges){
        const t=(b.type||"").toLowerCase();
        if(t.includes("broadcaster"))return"broadcaster";
        if(t.includes("moderator")||t==="mod")return"moderator";
        if(t.includes("vip"))return"vip";
        if(t.includes("subscriber")||t==="sub")return"subscriber";
    }
    return"viewer";
}

function renderBadges(badges){
    if(!Array.isArray(badges))return"";
    return `<div class="badges">${
        badges.map(b=>b.src?`<img class="badge" src="${b.src}">`:"").join("")
    }</div>`;
}

function addMessage(d){
    if(!d.chatmessage)return;

    const platform=detectPlatform(d);
    if(PLATFORMS!=="both" && platform!==PLATFORMS)return;

    const role=detectRole(d.chatbadges);
    const color=d.color||"#ffffff";

    const el=document.createElement("div");
    el.className=`message-container ${platform} ${role}`;

    el.innerHTML=`
    <div class="message">
        <div class="user-info">
            <img class="platform-logo" src="${LOGOS[platform]}">
            <div class="username" style="color:${color}">
                ${d.chatname||"User"}
            </div>
            ${renderBadges(d.chatbadges)}
        </div>
        <div class="message-text">${d.chatmessage}</div>
    </div>`;

    chat.appendChild(el);
    el.scrollIntoView({behavior:"smooth",block:"end"});

    setTimeout(()=>{
        el.classList.add("fade-out");
        setTimeout(()=>el.remove(),400);
    },DURATION);
}

/* SSN iframe */
const iframe=document.createElement("iframe");
iframe.src=`https://vdo.socialstream.ninja/?ln&push&novideo&noaudio&cleanoutput&room=${SESSION}`;
iframe.style.cssText="width:0;height:0;position:fixed;left:-100px;top:-100px";
document.body.appendChild(iframe);

window.addEventListener("message",e=>{
    if(e.data?.dataReceived?.overlayNinja){
        addMessage(e.data.dataReceived.overlayNinja);
    }
});
</script>
</body>
</html>
