<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SSN Chat Overlay</title>

<link href="https://fonts.googleapis.com/css2?family=Host+Grotesk:wght@300..800&display=swap" rel="stylesheet">

<style>
html,body{
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    background:transparent;
    overflow:hidden;
    font-family:'Host Grotesk',sans-serif;
}

#chat{
    padding:20px;
    max-width:440px;
}

/* animações */
.msg{
    margin-bottom:12px;
    animation:in .25s ease forwards;
}
.fade{
    animation:out .4s ease forwards;
}

@keyframes in{
    from{opacity:0;transform:translateY(12px)}
    to{opacity:1;transform:translateY(0)}
}
@keyframes out{
    to{opacity:0;transform:translateY(-10px)}
}

.box{
    background:rgba(25,25,25,.95);
    border-left:4px solid #888;
    padding:12px;
    border-radius:0 12px 12px 0;
    color:#fff;
}

.twitch .box{border-color:#9146FF}
.kick .box{border-color:#53FC18}

.header{
    display:flex;
    align-items:center;
    gap:6px;
    margin-bottom:6px;
}

.user{
    padding:4px 10px;
    border-radius:20px;
    font-weight:600;
    font-size:.9em;
    background:#444;
}

.broadcaster .user{background:#ff0000}
.moderator .user{background:#00ff00;color:#000}
.vip .user{background:#ffd700;color:#000}
.subscriber .user{background:#800080}

.badges{display:flex;gap:4px}
.badge{width:18px;height:18px}

.logo{
    width:18px;
    height:18px;
}

.text{font-size:14px;line-height:1.4}
</style>
</head>

<body>
<div id="chat"></div>

<script>
const chat=document.getElementById("chat");
const params=new URLSearchParams(location.search);
const ROOM=params.get("session")||"default";
const DURATION=(params.get("duration")||12)*1000;

const LOGO={
    twitch:"https://static-cdn.jtvnw.net/ttv-boxart/Twitch.png",
    kick:"https://kick.com/favicon.ico"
};

function platform(d){
    return (d.platform||d.type||"twitch").toLowerCase().includes("kick")?"kick":"twitch";
}

function role(b=[]){
    if(!Array.isArray(b))return"viewer";
    for(const x of b){
        const t=(x.type||"").toLowerCase();
        if(t.includes("broadcaster"))return"broadcaster";
        if(t.includes("moderator")||t==="mod")return"moderator";
        if(t.includes("vip"))return"vip";
        if(t.includes("subscriber")||t==="sub")return"subscriber";
    }
    return"viewer";
}

function badges(b=[]){
    return `<div class="badges">${
        b.map(x=>x.src?`<img class="badge" src="${x.src}">`:"").join("")
    }</div>`;
}

function add(d){
    if(!d.chatmessage)return;

    const p=platform(d);
    const r=role(d.chatbadges);
    const color=d.color||"#fff";

    const m=document.createElement("div");
    m.className=`msg ${p} ${r}`;
    m.innerHTML=`
    <div class="box">
        <div class="header">
            <img class="logo" src="${LOGO[p]}">
            <div class="user" style="color:${color}">${d.chatname||"User"}</div>
            ${badges(d.chatbadges)}
        </div>
        <div class="text">${d.chatmessage}</div>
    </div>`;

    chat.appendChild(m);
    m.scrollIntoView({behavior:"smooth"});

    setTimeout(()=>{
        m.classList.add("fade");
        setTimeout(()=>m.remove(),400);
    },DURATION);
}

/* WebSocket SSN */
let ws;
function connect(){
    ws=new WebSocket("wss://io.socialstream.ninja");
    ws.onopen=()=>ws.send(JSON.stringify({join:ROOM,out:3,in:4}));
    ws.onmessage=e=>{
        try{
            const d=JSON.parse(e.data);
            if(d.chatmessage)add(d);
        }catch{}
    };
    ws.onclose=()=>setTimeout(connect,2000);
}
connect();

/* iframe fallback */
const iframe=document.createElement("iframe");
iframe.src=`https://vdo.socialstream.ninja/?ln&push&novideo&noaudio&cleanoutput&room=${ROOM}`;
iframe.style.cssText="width:0;height:0;position:fixed;left:-100px;top:-100px";
document.body.appendChild(iframe);

window.addEventListener("message",e=>{
    if(e.data?.dataReceived?.overlayNinja){
        add(e.data.dataReceived.overlayNinja);
    }
});
</script>
</body>
</html>
